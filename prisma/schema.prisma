generator client {
  provider   = "prisma-client"
  output     = "./generated"
}

datasource db {
  provider = "postgresql"
}

enum TaskType {
  ANNUAL_PLAN
  ADHOC
}

enum TaskStatus {
  BACKLOG
  TODO
  IN_PROGRESS
  DONE
}

model Project {
  id    Int    @id @default(autoincrement())
  name  String @unique
  tasks Task[]
}

model Unit {
  id    Int    @id @default(autoincrement())
  name  String @unique
  tasks Task[]
}

model Person {
  id    Int    @id @default(autoincrement())
  name  String @unique
  tasks Task[]
}

model Task {
  id            Int        @id @default(autoincrement())
  type          TaskType   @default(ADHOC)
  status        TaskStatus @default(BACKLOG)

  projectId     Int
  project       Project    @relation(fields: [projectId], references: [id])

  title         String
  detail        String?
  ticketNo      String?

  unitId        Int?
  unit          Unit?      @relation(fields: [unitId], references: [id])

  responsibleId Int?
  responsible   Person?    @relation(fields: [responsibleId], references: [id])
  coResponsible String?

  year          Int?
  estimatedDays Float?
  daysSpent     Float      @default(0)
  progress      Int        @default(0)
  order         Int        @default(0)
  remarks       String?

  createdAt     DateTime   @default(now())
  updatedAt     DateTime   @updatedAt

  workLogs      WorkLog[]
}

enum SettingType {
  STRING
  NUMBER
  BOOLEAN
  DATE
}

model Setting {
  id          Int         @id @default(autoincrement())
  key         String      @unique
  value       String
  type        SettingType @default(STRING)
  label       String
  description String?

  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt
}

model WorkLog {
  id          Int      @id @default(autoincrement())
  date        DateTime
  daysWorked  Float
  description String?

  taskId      Int
  task        Task     @relation(fields: [taskId], references: [id], onDelete: Cascade)

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}
